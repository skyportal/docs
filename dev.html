
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Developer notes &#8212; skyportal 1.0.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/output_cells.css?v=4c393c42" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=f9c1cefe"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'dev';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Deployment" href="deploy.html" />
    <link rel="prev" title="API" href="api.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">skyportal 1.0.0 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="design.html">System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Developer notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="versioning.html">Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_loader.html">Data loader</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">How to Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="adding_features.html">Adding new features</a></li>
<li class="toctree-l1"><a class="reference internal" href="adding_comments_annotation_types.html">Adding a new type of Comment or Annotation</a></li>
<li class="toctree-l1"><a class="reference internal" href="styling.html">Styling components</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Database Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrations.html">Database migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="query_analysis.html">Analyzing database queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="permissions.html">Access controls</a></li>
<li class="toctree-l1"><a class="reference internal" href="slack.html">Slack Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="followup.html">Follow-up triggering</a></li>
<li class="toctree-l1"><a class="reference internal" href="mma.html">MMA Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="period.html">Periodic Timeseries Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="spatial_catalog.html">Spatial Catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_usage.html">Advanced usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="photometric_series.html">How to work with photometric series</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">SkyPortal Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="pages.html">Front-end Pages</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/dev.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Developer notes</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-commit-hook">Pre-commit hook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-fixtures">Test fixtures</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging">Debugging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#database">Database</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-images">Docker images</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-github-actions">Debugging GitHub Actions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-a-release">Making a release</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="developer-notes">
<h1>Developer notes<a class="headerlink" href="#developer-notes" title="Link to this heading">#</a></h1>
<section id="pre-commit-hook">
<h2>Pre-commit hook<a class="headerlink" href="#pre-commit-hook" title="Link to this heading">#</a></h2>
<p>Install our pre-commit hook as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pre</span><span class="o">-</span><span class="n">commit</span>
<span class="n">pre</span><span class="o">-</span><span class="n">commit</span> <span class="n">install</span>
</pre></div>
</div>
<p>This will check your changes before each commit to ensure that they
conform with our code style standards. We use black to reformat Python
code, and PrettierJS for JavaScript. We also run ESLint to catch
several common Redux usage bugs.</p>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h2>
<p>To execute the test suite:</p>
<ul class="simple">
<li><p>Install geckodriver and Firefox</p></li>
<li><p>To run all tests: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code></p></li>
<li><p>To run a single test: <code class="docutils literal notranslate"><span class="pre">./baselayer/tools/test_frontend.py</span> <span class="pre">skyportal/tests/frontend/&lt;test_file&gt;.py::test_&lt;specific_test&gt;</span></code></p></li>
</ul>
<p>This fires up the test server and runs that test. To make things
faster you can also run the test server separately:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">run_testing</span>   <span class="c1"># fire up the server with `test_conf.yaml`</span>

<span class="n">pytest</span> <span class="n">skyportal</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">api</span>  <span class="c1"># test api</span>
<span class="n">pytest</span> <span class="n">skyportal</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">frontend</span><span class="o">/</span><span class="n">test_user</span><span class="o">.</span><span class="n">py</span>  <span class="c1"># run subset of frontend tests</span>
<span class="n">pytest</span> <span class="n">skyportal</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">frontend</span><span class="o">/</span><span class="n">test_user</span><span class="o">.</span><span class="n">py</span><span class="p">::</span><span class="n">test_user_profile_fetching</span>  <span class="c1"># run a single test</span>
</pre></div>
</div>
<p>On Linux, the tests can be run in “headless” mode (no browser display):</p>
<ul class="simple">
<li><p>Install xvfb (<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">xvfb</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test_headless</span></code></p></li>
</ul>
<p>Or, as described above, launch the test server with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">run_testing</span></code>, and then call</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xvfb</span><span class="o">-</span><span class="n">run</span> <span class="n">pytest</span> <span class="n">skyportal</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">frontend</span><span class="o">/</span><span class="n">test_user</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>It is not noticeably faster to run the test suite headlessly.</p>
<section id="test-fixtures">
<h3>Test fixtures<a class="headerlink" href="#test-fixtures" title="Link to this heading">#</a></h3>
<p>The SkyPortal test suite leverages pytest fixtures to generate and isolate test data for each test. Fixtures are declared in the <code class="docutils literal notranslate"><span class="pre">skyportal/tests/conftest.py</span></code> file, and they utilize factories implemented in <code class="docutils literal notranslate"><span class="pre">skyportal/tests/fixtures.py</span></code> to generate new instances of fixtures as needed.</p>
<p>Each test will request any fixtures that it requires, and as part of the set-up for that test, new test instances of the fixtures are created. This means that each test is guaranteed to work with fresh, isolated test data in order to avoid any unintended dependencies on other tests. Fixtures should be used when possible in writing new tests to promote safe, repeatable test results.</p>
<p>SkyPortal test fixtures are implemented with teardown logic, such that any database records generated for that fixture are deleted from the test database upon completion of a test. This serves to avoid bloating of the test database as more tests are run. Note that each fixture defined in <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> uses the <code class="docutils literal notranslate"><span class="pre">yield</span></code> keyword to return its test object. Any code following <code class="docutils literal notranslate"><span class="pre">yield</span></code> in a pytest fixture is run as teardown logic when that fixture goes out of scope; you will find that in SkyPortal this involves calling the relevant <code class="docutils literal notranslate"><span class="pre">teardown()</span></code> functions on the fixture objects created. These <code class="docutils literal notranslate"><span class="pre">teardown()</span></code> functions are implemented for each SQLAlchemyModelFactory subclass defined in <code class="docutils literal notranslate"><span class="pre">fixtures.py</span></code>.</p>
<p>Any new fixtures and fixture factories being added should follow this same structure, taking care to delete all fixture data (including SubFactory-generated records, i.e. a new User created to be the author of a new Comment). Foreign key constraints and cascade behavior defined on the database models can be used to simplify this logic but can also lead to subtle errors in tearing down fixtures and should be taken into careful consideration.</p>
</section>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">log</span></code> to watch log output</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">stop</span></code> to stop any running web services.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">attach</span></code> to attach to output of webserver, e.g. for use with <code class="docutils literal notranslate"><span class="pre">pdb.set_trace()</span></code></p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">check-js-updates</span></code> to see which Javascript packages are eligible for an upgrade.</p></li>
</ul>
</section>
<section id="database">
<h2>Database<a class="headerlink" href="#database" title="Link to this heading">#</a></h2>
<p>All interactions with the database are performed by way of SQLAlchemy using the
Pyscopg2 backend. Some standard but not necessarily obvious usage patterns we
make use of include:</p>
<ul class="simple">
<li><p>Logic for connecting to the DB, refreshing tables, etc. is found in <code class="docutils literal notranslate"><span class="pre">baselayer/model_utils.py</span></code>:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">baselayer.app.env</span> <span class="kn">import</span> <span class="n">load_env</span>
<span class="kn">from</span> <span class="nn">skyportal.models</span> <span class="kn">import</span> <span class="n">DBSession</span><span class="p">,</span> <span class="n">init_db</span>
<span class="n">env</span><span class="p">,</span> <span class="n">cfg</span> <span class="o">=</span> <span class="n">load_env</span><span class="p">()</span>
<span class="n">init_db</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">])</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The session object controls various DB state operations:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DBSession</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>  <span class="c1"># add a new object into the DB</span>
<span class="n">DBSession</span><span class="p">()</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># commit modifications to objects</span>
<span class="n">DBSession</span><span class="p">()</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>  <span class="c1"># recover after a DB error</span>
</pre></div>
</div>
<p>For more information on how to use the session, see <code class="docutils literal notranslate"><span class="pre">baselayer/doc/dev.md</span></code>.</p>
<ul class="simple">
<li><p>Generic logic applicable to any model is included in the base model class <code class="docutils literal notranslate"><span class="pre">baselayer.app.models.Base</span></code> (<code class="docutils literal notranslate"><span class="pre">to_dict</span></code>, <code class="docutils literal notranslate"><span class="pre">__str__</span></code>, etc.), but can be overridden within a specific model</p></li>
<li><p>Models can be queried directly (<code class="docutils literal notranslate"><span class="pre">User.query.all()</span></code>), or more specific queries can be constructed via the session object (<code class="docutils literal notranslate"><span class="pre">DBSession().query(User.id).all()</span></code>)</p></li>
<li><p>A more modern way to interact with the models is using select statements: <code class="docutils literal notranslate"><span class="pre">Obj.select(current_user_id).where(Obj.id</span> <span class="pre">==</span> <span class="pre">'ZTF20aahxjps')</span></code></p></li>
<li><p>To get the actual objects create a session (either using <code class="docutils literal notranslate"><span class="pre">self.Session()</span></code> on the handler or using <code class="docutils literal notranslate"><span class="pre">DBSession()</span></code> which does not apply permissioning).
Then use the session: <code class="docutils literal notranslate"><span class="pre">session.execute(stmt).all()</span></code> or <code class="docutils literal notranslate"><span class="pre">session.scalars(stmt).all()</span></code>. The <code class="docutils literal notranslate"><span class="pre">scalars</span></code> is preferred when selecting whole objects or single columns.
The <code class="docutils literal notranslate"><span class="pre">execute</span></code> is better for getting multiple columns as tuples.</p></li>
<li><p>Best practice is to call the session as a context manager (i.e., <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">self.Session()</span> <span class="pre">as</span> <span class="pre">session:</span></code>) but only if the session does not need to stay open.</p></li>
<li><p>Convenience functionality:</p>
<ul>
<li><p>Join relationships: some multi-step relationships are defined through joins using the <code class="docutils literal notranslate"><span class="pre">secondary</span></code> parameter to eliminate queries from the intermediate table; e.g., <code class="docutils literal notranslate"><span class="pre">User.acls</span></code> instad of <code class="docutils literal notranslate"><span class="pre">[r.acls</span> <span class="pre">for</span> <span class="pre">r</span> <span class="pre">in</span> <span class="pre">User.roles]</span></code></p></li>
<li><p><a class="reference external" href="http://docs.sqlalchemy.org/en/latest/orm/extensions/associationproxy.html">Association proxies</a>: shortcut to some attribute of a related object; e.g., <code class="docutils literal notranslate"><span class="pre">User.permissions</span></code> instead of <code class="docutils literal notranslate"><span class="pre">[a.id</span> <span class="pre">for</span> <span class="pre">a</span> <span class="pre">in</span> <span class="pre">User.acls]</span></code></p></li>
<li><p><a class="reference external" href="http://docs.sqlalchemy.org/en/latest/orm/loading_relationships.html">Joined loads</a>: this allows for a single query to also include child/related objects; often used in handlers when we know that information about related objects will also be needed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">to_json()</span></code>: often from a handler we return an ORM object, which gets converted to JSON via <code class="docutils literal notranslate"><span class="pre">json_util.to_json(obj.to_dict())</span></code>. This also includes the attributes of any children that were loaded via <code class="docutils literal notranslate"><span class="pre">joinedload</span></code> or by accessing them directly. For example:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">User.query.first().to_dict()</span></code> will not contain information about the user’s permissions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">u</span> <span class="pre">=</span> <span class="pre">User.query.first();</span> <span class="pre">u.acls;</span> <span class="pre">u.to_dict()</span></code> does include a list of the user’s ACLs</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="docker-images">
<h2>Docker images<a class="headerlink" href="#docker-images" title="Link to this heading">#</a></h2>
<p>Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">docker-images</span></code> to build and push to Docker hub.</p>
</section>
<section id="debugging-github-actions">
<h2>Debugging GitHub Actions<a class="headerlink" href="#debugging-github-actions" title="Link to this heading">#</a></h2>
<p>You can insert the following step to debug your workflow:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup tmate session</span>
<span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mxschmitt/action-tmate@v2</span>
</pre></div>
</div>
<p>It will print a command that you can use to SSH into the runner.</p>
</section>
<section id="making-a-release">
<h2>Making a release<a class="headerlink" href="#making-a-release" title="Link to this heading">#</a></h2>
<p><strong>Please also see <a class="reference internal" href="versioning.html"><span class="doc">versioning</span></a>.</strong></p>
<ol>
<li><p>Update the version number in <code class="docutils literal notranslate"><span class="pre">skyportal/__init__.py</span></code>.</p></li>
<li><p>Commit the changes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">add</span> <span class="n">skyportal</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">am</span> <span class="s2">&quot;Update version to v$</span><span class="si">{NEW_VERSION}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</li>
<li><p>Tag &amp; sign the release:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>git tag -s v${NEW_VERSION} -m &quot;SkyPortal v${NEW_VERSION} release&quot;
</pre></div>
</div>
<p>(If you do not have a GPG key, follow the tutorial to set it up:
https://help.github.com/articles/signing-commits-with-gpg/)</p>
</li>
<li><p>Push the changes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span> <span class="o">--</span><span class="n">tags</span> <span class="n">origin</span> <span class="n">main</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">origin</span></code> points to the <code class="docutils literal notranslate"><span class="pre">github.com:skyportal/skyportal</span></code> repository.</p>
</li>
<li><p>Create a new release on GitHub, using the tag you just created. The release should be formatted as follows:</p>
<ul class="simple">
<li><p>A title, in the form <code class="docutils literal notranslate"><span class="pre">SkyPortal</span> <span class="pre">v${NEW_VERSION}</span> <span class="pre">release</span> <span class="pre">(YYYY-MM-DD)</span></code></p></li>
<li><p>A brief summary of the changes, including any breaking changes</p></li>
<li><p>A list of the changes split in the relevant categories (e.g., new features, bug fixes, frontend, backend, etc.). For each change, include a list of the associated PR numbers, as well as the GitHub usernames of the contributors.</p></li>
<li><p>If applicable, a migration guide to help users and/or admins upgrade to the new version.</p></li>
</ul>
</li>
</ol>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="api.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">API</p>
      </div>
    </a>
    <a class="right-next"
       href="deploy.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Deployment</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-commit-hook">Pre-commit hook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-fixtures">Test fixtures</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging">Debugging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#database">Database</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-images">Docker images</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-github-actions">Debugging GitHub Actions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-a-release">Making a release</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The SkyPortal Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2020–2023, The SkyPortal Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>