<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Image Analysis &mdash; skyportal 0.9.dev0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/output_cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SkyPortal Extensions" href="extensions.html" />
    <link rel="prev" title="Analysis" href="analysis.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> skyportal
          </a>
              <div class="version">
                0.9.dev0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="design.html">System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Developer notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_loader.html">Data loader</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">How to Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="adding_features.html">Adding new features</a></li>
<li class="toctree-l1"><a class="reference internal" href="styling.html">Styling components</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Database Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrations.html">Database migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="query_analysis.html">Analyzing database queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="permissions.html">Access controls</a></li>
<li class="toctree-l1"><a class="reference internal" href="slack.html">Slack Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="followup.html">Follow-up triggering</a></li>
<li class="toctree-l1"><a class="reference internal" href="mma.html">MMA Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="spatial_catalog.html">Spatial Catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_usage.html">Advanced usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">Analysis</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Image Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installing-system-dependencies-required-by-stdpipe-debian-based-linux-and-wsl">Installing System Dependencies required by STDpipe (Debian-based Linux and WSL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-stdpipe">Installing STDpipe</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-file">Configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deploy-using-docker">Deploy using Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">SkyPortal Extensions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">skyportal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Image Analysis</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="image-analysis">
<h1>Image Analysis<a class="headerlink" href="#image-analysis" title="Permalink to this heading"></a></h1>
<p>This feature allows users to upload FITS images from observations of a source, and then use STDPipe to <strong>extract the photometry from the image</strong>.
As this feature requires additional system dependencies, we choose to make it optional.</p>
<section id="installing-system-dependencies-required-by-stdpipe-debian-based-linux-and-wsl">
<h2>Installing System Dependencies required by STDpipe (Debian-based Linux and WSL)<a class="headerlink" href="#installing-system-dependencies-required-by-stdpipe-debian-based-linux-and-wsl" title="Permalink to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">sextractor</span> <span class="n">scamp</span> <span class="n">psfex</span> <span class="n">swarp</span>
</pre></div>
</div>
<p>Also, one needs to install <code class="docutils literal notranslate"><span class="pre">snid</span></code>. To install it, you can run the following commands which will git clone and run an install script (works only on ubuntu for now, both arm64 and amd64)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Theodlz</span><span class="o">/</span><span class="n">snid</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">git</span> <span class="o">&amp;&amp;</span> \
<span class="n">cd</span> <span class="n">snid</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="n">ubuntu</span> <span class="o">&amp;&amp;</span> <span class="n">sudo</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">install</span><span class="o">.</span><span class="n">sh</span> <span class="o">&amp;&amp;</span> <span class="n">sudo</span> <span class="n">bash</span> <span class="o">./</span><span class="n">install</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</section>
<section id="installing-stdpipe">
<h2>Installing STDpipe<a class="headerlink" href="#installing-stdpipe" title="Permalink to this heading"></a></h2>
<p>As of right now, STDpipe is in development, and not available on pypi or conda yet.
STDpipe is available at https://github.com/karpov-sv/stdpipe and is mirrored at https://gitlab.in2p3.fr/icare/stdpipe</p>
<ol class="simple">
<li><p>Get the installer</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">skyportal</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">karpov</span><span class="o">-</span><span class="n">sv</span><span class="o">/</span><span class="n">stdpipe</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Installing it in your virtual environment</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">skyportal_env</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">cd</span> <span class="n">stdpipe</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
</section>
<section id="configuration-file">
<h2>Configuration file<a class="headerlink" href="#configuration-file" title="Permalink to this heading"></a></h2>
<p>By default, the app allows a maximum request size of 10MB (from the client). This is not enough for someone to upload most .fits files (compressed or not).
To increase the maximum request size, change the <code class="docutils literal notranslate"><span class="pre">max_body_size:</span> <span class="pre">10</span></code> parameter in the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file to a larger value, like <code class="docutils literal notranslate"><span class="pre">100</span></code> (in MB).</p>
<p>Also, as mentioned earlier, you need to add <code class="docutils literal notranslate"><span class="pre">image_analysis:</span> </code> in the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file. By default, it is not present.
Later, this field of the config file will be used to configure the image analysis feature.</p>
<p>Moreover, in the app.routes, uncomment the following lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">path</span><span class="p">:</span> <span class="s2">&quot;/source/:id/image_analysis&quot;</span>
  <span class="n">component</span><span class="p">:</span> <span class="n">ImageAnalysisPage</span>
</pre></div>
</div>
<p>This will add the frontend route to the image analysis page.</p>
<p><strong>If you are deploying SkyPortal using Docker, don’t forget to add the same changes to the <code class="docutils literal notranslate"><span class="pre">docker.yaml</span></code> file as well.</strong></p>
</section>
<section id="deploy-using-docker">
<h2>Deploy using Docker<a class="headerlink" href="#deploy-using-docker" title="Permalink to this heading"></a></h2>
<p>If you are deploying SkyPortal using Docker, you need to uncomment a few lines from the Dockerfile, which are commented out by default. These lines are here to install the system and python dependencies required by STDpipe.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> \
    <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">sextractor</span> <span class="n">scamp</span> <span class="n">psfex</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RUN</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Theodlz</span><span class="o">/</span><span class="n">snid</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">git</span> <span class="o">&amp;&amp;</span> \
    <span class="n">cd</span> <span class="n">snid</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="n">ubuntu</span> <span class="o">&amp;&amp;</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">install</span><span class="o">.</span><span class="n">sh</span> <span class="o">&amp;&amp;</span> <span class="n">bash</span> <span class="o">./</span><span class="n">install</span><span class="o">.</span><span class="n">sh</span>

<span class="n">RUN</span> <span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="o">/</span><span class="n">skyportal_env</span> <span class="o">&amp;&amp;</span> \
    <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;source /skyportal_env/bin/activate &amp;&amp; </span><span class="se">\</span>
<span class="s2">    git clone https://github.com/karpov-sv/stdpipe.git &amp;&amp; </span><span class="se">\</span>
<span class="s2">    cd stdpipe &amp;&amp; pip install -e . &amp;&amp; </span><span class="se">\</span>
<span class="s2">    pip install astroscrappy&quot;</span>
</pre></div>
</div>
<p>Again, add the same lines mentioned in the Configuration section to the <code class="docutils literal notranslate"><span class="pre">docker.yaml</span></code> file.</p>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>Go to the page of a source, and click on the <code class="docutils literal notranslate"><span class="pre">Image</span> <span class="pre">Analysis</span></code> right button under the photometry plot. It will redirect you to the image analysis page.
Then, fill in the fields required by the form, and upload the image. The operations performed by STDpipe are computation intensive, so it can take several minutes to extract the photometry from the image.</p>
<p><strong>The image must be a compressed FITS file (.fits.fz). We recommend compressing it with funpack.</strong></p>
<p>Now, click submit. When the photometry is extracted (it will take around a minute), you should receive a frontend notification.
To see if STDpipe managed to extract the photometry from your image, you can simply go back to the source page and see if the photometry is there on the plot, or in the <code class="docutils literal notranslate"><span class="pre">manage</span> <span class="pre">data</span></code> table.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="analysis.html" class="btn btn-neutral float-left" title="Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="extensions.html" class="btn btn-neutral float-right" title="SkyPortal Extensions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020–2023, The SkyPortal Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>